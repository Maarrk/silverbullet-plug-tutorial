var mod=(()=>{var p=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var E=Object.prototype.hasOwnProperty;var l=(e,t)=>{for(var o in t)p(e,o,{get:t[o],enumerable:!0})},N=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of k(t))!E.call(e,i)&&i!==o&&p(e,i,{get:()=>t[i],enumerable:!(n=U(t,i))||n.enumerable});return e};var K=e=>N(p({},"__esModule",{value:!0}),e);var Je={};l(Je,{functionMapping:()=>F});typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var y=new Map,g=0;function f(e){self.postMessage(e)}self.syscall=async(e,...t)=>await new Promise((o,n)=>{g++,y.set(g,{resolve:o,reject:n}),f({type:"sys",id:g,name:e,args:t})});function b(e,t){self.addEventListener("message",o=>{(async()=>{let n=o.data;switch(n.type){case"inv":{let i=e[n.name];if(!i)throw new Error(`Function not loaded: ${n.name}`);try{let s=await Promise.resolve(i(...n.args||[]));f({type:"invr",id:n.id,result:s})}catch(s){console.error("An exception was thrown as a result of invoking function",n.name,"error:",s),f({type:"invr",id:n.id,error:s.message})}}break;case"sysr":{let i=n.id,s=y.get(i);if(!s)throw Error("Invalid request id");y.delete(i),n.error?s.reject(new Error(n.error)):s.resolve(n.result)}break}})().catch(console.error)}),f({type:"manifest",manifest:t})}function R(e){let t=atob(e),o=t.length,n=new Uint8Array(o);for(let i=0;i<o;i++)n[i]=t.charCodeAt(i);return n}function w(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let t="",o=e.byteLength;for(let n=0;n<o;n++)t+=String.fromCharCode(e[n]);return btoa(t)}async function D(e,t){if(typeof e!="string"){let o=new Uint8Array(await e.arrayBuffer()),n=o.length>0?w(o):void 0;t={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:n},e=e.url}return syscall("sandboxFetch.fetch",e,t)}function O(){globalThis.nativeFetch=globalThis.fetch,globalThis.fetch=async function(e,t){let o=t&&t.body?w(new Uint8Array(await new Response(t.body).arrayBuffer())):void 0,n=await D(e,t&&{method:t.method,headers:t.headers,base64Body:o});return new Response(n.base64Body?R(n.base64Body):null,{status:n.status,headers:n.headers})}}O();var c={};l(c,{confirm:()=>se,dispatch:()=>oe,downloadFile:()=>_,filterBox:()=>J,flashNotification:()=>z,fold:()=>ue,foldAll:()=>me,getCurrentPage:()=>W,getCursor:()=>L,getSelection:()=>I,getText:()=>B,getUiOption:()=>ae,hidePanel:()=>Z,insertAtCursor:()=>ne,insertAtPos:()=>ee,moveCursor:()=>re,navigate:()=>Y,openUrl:()=>V,prompt:()=>ie,reloadPage:()=>Q,reloadUI:()=>G,replaceRange:()=>te,save:()=>j,setPage:()=>q,setSelection:()=>$,setUiOption:()=>ce,showPanel:()=>X,toggleFold:()=>fe,unfold:()=>de,unfoldAll:()=>pe,uploadFile:()=>H,vimEx:()=>le});typeof self>"u"&&(self={syscall:()=>{throw new Error("Not implemented here")}});var r=self.syscall;function W(){return r("editor.getCurrentPage")}function q(e){return r("editor.setPage",e)}function B(){return r("editor.getText")}function L(){return r("editor.getCursor")}function I(){return r("editor.getSelection")}function $(e,t){return r("editor.setSelection",e,t)}function j(){return r("editor.save")}function Y(e,t,o=!1,n=!1){return r("editor.navigate",e,t,o,n)}function Q(){return r("editor.reloadPage")}function G(){return r("editor.reloadUI")}function V(e,t=!1){return r("editor.openUrl",e,t)}function _(e,t){return r("editor.downloadFile",e,t)}function H(e,t){return r("editor.uploadFile",e,t)}function z(e,t="info"){return r("editor.flashNotification",e,t)}function J(e,t,o="",n=""){return r("editor.filterBox",e,t,o,n)}function X(e,t,o,n=""){return r("editor.showPanel",e,t,o,n)}function Z(e){return r("editor.hidePanel",e)}function ee(e,t){return r("editor.insertAtPos",e,t)}function te(e,t,o){return r("editor.replaceRange",e,t,o)}function re(e,t=!1){return r("editor.moveCursor",e,t)}function ne(e){return r("editor.insertAtCursor",e)}function oe(e){return r("editor.dispatch",e)}function ie(e,t=""){return r("editor.prompt",e,t)}function se(e){return r("editor.confirm",e)}function ae(e){return r("editor.getUiOption",e)}function ce(e,t){return r("editor.setUiOption",e,t)}function le(e){return r("editor.vimEx",e)}function ue(){return r("editor.fold")}function de(){return r("editor.unfold")}function fe(){return r("editor.toggleFold")}function me(){return r("editor.foldAll")}function pe(){return r("editor.unfoldAll")}var m={};l(m,{parseMarkdown:()=>ge});function ge(e){return r("markdown.parseMarkdown",e)}var u={};l(u,{deleteAttachment:()=>Me,deleteFile:()=>Ee,deletePage:()=>Te,getAttachmentMeta:()=>ve,getFileMeta:()=>Ue,getPageMeta:()=>Pe,listAttachments:()=>we,listFiles:()=>Ce,listPages:()=>ye,listPlugs:()=>be,readAttachment:()=>Ae,readFile:()=>Fe,readPage:()=>xe,writeAttachment:()=>Se,writeFile:()=>ke,writePage:()=>he});function ye(e=!1){return r("space.listPages",e)}function Pe(e){return r("space.getPageMeta",e)}function xe(e){return r("space.readPage",e)}function he(e,t){return r("space.writePage",e,t)}function Te(e){return r("space.deletePage",e)}function be(){return r("space.listPlugs")}function we(){return r("space.listAttachments")}function ve(e){return r("space.getAttachmentMeta",e)}function Ae(e){return r("space.readAttachment",e)}function Se(e,t){return r("space.writeAttachment",e,t)}function Me(e){return r("space.deleteAttachment",e)}function Ce(){return r("space.listFiles")}function Fe(e){return r("space.readFile",e)}function Ue(e){return r("space.getFileMeta",e)}function ke(e,t){return r("space.writeFile",e,t)}function Ee(e){return r("space.deleteFile",e)}function P(e,t){if(t(e))return[e];let o=[];if(e.children)for(let n of e.children)o=[...o,...P(n,t)];return o}function x(e,t){return P(e,o=>o.type===t)[0]}function v(e,t){P(e,t)}var a=globalThis.syscall;var d={};l(d,{parse:()=>$e,stringify:()=>je});function $e(e){return a("yaml.parse",e)}function je(e){return a("yaml.stringify",e)}async function Ge(e,t){let o=await u.readPage(e),n=await m.parseMarkdown(o),i;return v(n,s=>{if(s.type!=="FencedCode")return!1;let h=x(s,"CodeInfo");if(t&&!h||t&&!t.includes(h.children[0].text))return!1;let T=x(s,"CodeText");return T?(i=T.children[0].text,!0):!1}),i}async function A(e,t=["yaml"]){let o=await Ge(e,t);if(o!==void 0)try{return d.parse(o)}catch(n){throw console.error("YAML Page parser error",n),new Error(`YAML Error: ${n.message}`)}}var Ve="SETTINGS";async function S(e,t){try{let n=(await A(Ve,["yaml"])||{})[e];return n===void 0?t:n}catch(o){if(o.message==="Not found")return t;throw o}}var _e="tutorialPlug",He={userCount:1};async function M(){await c.flashNotification("Hello world!")}async function C(){let e={...He,...await S(_e,{})},t=1+Math.floor(Math.random()*e.userCount);console.log(e,t);let o=await fetch(`https://jsonplaceholder.typicode.com/users/${t}`);if(o.status<200||o.status>=300)if(o.status==404){await c.flashNotification("Couldn't fetch random user, ensure userCount is not greater than 10","error");return}else throw new Error(await o.text());let n=await o.json();await c.flashNotification(n.name)}var F={helloWorld:M,randomUser:C},ze={name:"tutorial",requiredPermissions:["fetch"],functions:{helloWorld:{path:"tutorial.ts:helloWorld",command:{name:"Tutorial: Say hello"}},randomUser:{path:"tutorial.ts:randomUser",command:{name:"Tutorial: Show random user name"}}},assets:{}};b(F,ze);return K(Je);})();
